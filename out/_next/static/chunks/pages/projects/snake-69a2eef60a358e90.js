(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{4570:function(t,e,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/projects/snake",function(){return s(65250)}])},65250:function(t,e,s){"use strict";s.r(e);var a=s(35944),r=s(67294),i=s(56863),h=s(11057),o=s(78862),n=s(16871),l=s(87751);let c=(t,e,s)=>[[t[0],t[1]-1],[t[0]+1,t[1]],[t[0],t[1]+1],[t[0]-1,t[1]]].filter(t=>t[0]>=0&&t[1]>=0&&t[0]<=e&&t[1]<=s),p=(t,e)=>{let[s,a]=t,[r,i]=e;return s===r&&a===i},d=(t,e)=>t.some(t=>p(t,e)),u=(t,e)=>t.filter(t=>!d(e,t)),g=(t,e,s)=>e.concat(t).slice(0,e.length+(t.length-e.length+(s?1:0))),m=t=>t[t.length-1];function f(t,e,s,a,r){let i=[t],h={[t]:[t]};for(;i.length;){let o=i.shift(),n=g(r,h[o]=h[o]||[t]);if(p(o,e))return h[o];for(let l of u(c(o,s,a),n))l in h||(i.push(l),h[l]=[l].concat(h[o]))}}function P(t,e,s,a,r){let i=e*s*2,h=e-1,o=s-1;if(!d(c(a[0],h,o),t))return 0;let n=f(t,r,h,o,a);if(n){let l=g(a,n,!0);for(let p of u(c(r,h,o),l))if(f(p,m(l),h,o,l))return n.length}let P=f(t,m(a),h,o,a);return P?i-P.length:2*i}function b(t){return Math.floor(Math.random()*t)}function S(t,e){let s=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(s**2+a**2)}class L{constructor(t,e,s,a,r,i,h){this.pos=t,this.g=e,this.h=s,this.l=a,this.e=r,this.f=i,this.parent=h}}class y extends r.Component{parse(t){return t.split(",").map(t=>parseInt(t))}getNeighbors(t,e){let s=[];return t>0&&s.push([t-1,e]),t<this.row-1&&s.push([t+1,e]),e>0&&s.push([t,e-1]),e<this.col-1&&s.push([t,e+1]),s}getFreeNeighbors(t,e){let s=this.getNeighbors(t,e).filter(t=>{let e=this.board[t[0]][t[1]];return"apple"===e||"ground"===e});return s}getFreeNeighborsWithNode(t,e,s){let a=this.snakeq.toArray().concat(s.pos),r=this.getNeighbors(t,e).filter(t=>!this.inBody(t[0],t[1],a));return r}randTotal(){return Math.floor(Math.random()*this.col*this.row)}randRow(){return Math.floor(Math.random()*this.row)}randCol(){return Math.floor(Math.random()*this.col)}createGradient(){for(let t=0;t<this.searchParamListDefault.length;t++){let e=[...this.searchParamListDefault];e[t]+=this.epsilon;let s=[...this.searchParamListDefault];s[t]-=this.epsilon,this.searchParamStack.push(e),this.searchParamStack.push(s),this.searchParamResults.set("Plus".concat(t),0),this.searchParamResults.set("Minus".concat(t),0)}}calculateGradient(){for(let t=0;t<this.searchParamListDefault.length;t++){let e=this.searchParamResults.get("Plus".concat(t)),s=this.searchParamResults.get("Minus".concat(t));this.gradient[t]=e-s}}updateGradientBaseValue(){this.searchParamList=this.searchParamListDefault.map((t,e)=>t-this.gradient[e]*this.learningRate),this.searchParamListDefault=this.searchParamList.flat()}clearAll(){this.board=Array(this.row).fill(Array(this.col).fill(0)),this.board=this.board.map(t=>t.map(t=>"ground")),this.snakeq.clear(),this.head=[0,0],this.apple=[3,3],this.snakeq.enqueue(this.head),this.curLen=1,this.path.clear(),this.renderBoard(this.RENDER)}renderBoard(t){this.board=this.board.map(t=>t.map(t=>"ground")),this.snakeq.toArray().map(t=>{this.board[t[0]][t[1]]="body"}),void 0!=this.apple&&this.apple[0]>-1&&(this.board[this.apple[0]][this.apple[1]]="apple"),this.boardMap=this.board.map((t,e)=>t.map((t,s)=>[t,"body"===this.board[e][s]?"hsl(".concat(100+e*s,",50%,50%)"):"",(e*this.col+s).toString()])),t&&this.setState(t=>({frame:this.state.frame+1}))}getCoords(t){let e=[],s=t;for(;void 0!=s.parent;)e.push(s.pos),s=s.parent;return e}scoreCoords(t){let e=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let i of t){let[h,o]=i;e=Math.min(e,h),s=Math.min(s,o),a=Math.max(a,h),r=Math.max(r,o)}let n=a-e,l=r-s,c=0;for(let p=0;p<t.length;p++)for(let d=p+1;d<t.length;d++){let[u,g]=t[p],[m,f]=t[d],P=Math.sqrt((m-u)**2+(f-g)**2);c+=P}let b=c/(t.length*(t.length-1)/2);return b/Math.sqrt(n*l)}updatePath(){this.path.clear();let t=new Map,e=this.astar(this.head,this.apple,this.apple,[],t,(t,e,s,a)=>this.searchParamList[1]*t+this.searchParamList[1]*e+this.searchParamList[1]*s+this.searchParamList[1]*a);e||(console.log("resolved to greedy"),this.path.set(this.head.toString(),this.greedySafe()))}multiPath(){this.path.clear();let t=[],e=new Map,s=this.astar(this.head,this.apple,this.apple,t,e,(t,e,s,a)=>t+e+10*s);this.path=e,s||(this.path=e,console.log("no path to apple, route to rear"),(s=this.astar(this.head,this.rear,this.rear,t,e,(t,e,s,a)=>t+e))||(this.path.clear(),console.log("resolved to available"),this.path.set(this.head.toString(),this.random())))}useAStar(){0==this.path.size&&(console.log("making new path"),this.simplePath());let t=this.path.get(this.head.toString());return this.path.delete(this.head.toString()),t}buildPathFromNode(t){let e=[];for(;void 0!=t;)e.push(t.pos),t=t.parent;return e}simplePath(){this.path.clear()}bfs(t,e){}astar(t,e,s,a,r,i){let h=new Set,o=new Set,n=new Set,c=Array(this.row).fill(Array(this.col)),p=new l.Z3((t,e)=>t.f>e.f?1:t.f<e.f?-1:0),d=new L(t,0,0,0,0,0);for(c[d.pos[0]][d.pos[1]]=d,o.add(t.toString()),p.clear(),p.push(d);o.size>0&&++this.tracker<this.maxIterations;){let u=p.pop(),g=u.pos.toString();o.delete(g),h.add(g),n.add(g);let m=this.getFreeNeighbors(u.pos[0],u.pos[1]);for(let f of(this.buildPathFromNode(u).map(t=>{this.graph.removeEdges(this.makeId(t))}),m.map(t=>new L(t,0,0,0,0,0,u)))){if(f.pos.toString()===e.toString()){this.path.clear(),a=[];let P=f;for(;void 0!=P.parent&&null!=P;)a.push(P.pos),r.set(P.parent.pos.toString(),P.pos),P.pos,P=P.parent;return!0}if(!h.has(f.pos.toString())){let b=0,y=Object.getOwnPropertyNames(this.graph.getConnectedEdges(this.makeId(f.pos))).map(t=>parseInt(t));y.map(t=>this.graph.removeEdges(t)),this.graph.traverseBfs(this.makeId(f.pos),(t,e)=>{b++},()=>!1),y.map(t=>this.graph.addEdge(this.makeId(f.pos),t)),f.l=b,f.g=u.g+1,f.h=S(f.pos,s),f.f=i(f.g,f.h,f.l,f.e);let N=c[f.pos[0]][f.pos[1]];if(o.has(f.pos.toString())&&f.f>N.f)break;o.add(f.pos.toString()),c[f.pos[0]][f.pos[1]]=f,p.push(f)}}}return this.tracker==this.maxIterations&&console.log("too many iterations"),this.tracker=0,!1}greedy(){return this.getFreeNeighbors(this.head[0],this.head[1]).sort((t,e)=>S(t,this.apple)-S(e,this.apple))[0]}greedySafe(){return this.getFreeNeighbors(this.head[0],this.head[1]).sort((t,e)=>this.getFreeNeighbors(e[0],e[1]).length-this.getFreeNeighbors(t[0],t[1]).length)[0]}random(){let t=this.getFreeNeighbors(this.head[0],this.head[1]);return t[b(t.length)]}makeApple(){let t=[];for(let e=0;e<this.row;e++)for(let s=0;s<this.col;s++)"ground"===this.board[e][s]&&t.push([e,s]);let a=t[b(t.length)];this.apple=a}inBoard(t,e){return e>=0&&e<this.col&&t>=0&&t<this.row}choose(t,e){this.snakeq.size()>this.curLen&&(this.rear=this.snakeq.dequeue()),this.snake.push([t,e]),this.snakeq.enqueue([t,e]),this.head=[t,e],"apple"===this.board[t][e]&&(this.apple[0]=-1,this.makeApple(),this.curLen++),this.createAdjacency()}inBody(t,e,s){return 0<s.filter(s=>s[0]==t&&s[1]==e).length}createAdjacency(){this.graph=new l.kJ;for(let t=0;t<this.row;t++)for(let e=0;e<this.row;e++)this.adjacency[t*this.col+e]=this.getNeighbors(t,e).map(t=>({pos:t,str:t.toString(),type:this.board[t[0]][t[1]],isBody:"body"===this.board[t[0]][t[1]],isApple:"apple"===this.board[t[0]][t[1]],isGround:"ground"===this.board[t[0]][t[1]]}))}headToTail(){let t=this.getFreeNeighbors(this.head[0],this.head[1]),e=[],s=Number.MAX_SAFE_INTEGER;for(let a of t){let r=P(a,this.row,this.col,this.snakeq.toArray().reverse(),this.apple);s>r&&r>0&&(s=r,e=a)}return e}test(){console.log("start test");let t=c(this.head,this.row-1,this.col-1);for(let e of(console.log(t),t))console.log(P(e,this.row,this.col,this.snakeq.toArray(),this.apple));console.log("end test")}update(){this.cycles++;var t=this.random();if(void 0===(t=this.headToTail())||void 0===t[0]||void 0===t[1]){if(console.log("UNDEFINED choice"),console.log("Score: cycles=".concat(this.cycles," len=").concat(this.curLen," HighScore=").concat(this.highScoreLen," currentParams=").concat(this.searchParamList)),this.lastScore=this.curScore,this.curLen>this.highScoreLen&&(this.highScoreLen=this.curLen),this.cycles<this.highScoreCycles&&(this.highScoreCycles=this.cycles),this.cycles=0,this.LEARN&&(this.performanceRunMap.has(this.searchParamList.toString())?this.performanceRunMap.get(this.searchParamList.toString()).push(this.curLen):this.performanceRunMap.set(this.searchParamList.toString(),[this.curLen]),++this.iterationsCurrent>this.iterationsPerSim)){let e=this.performanceRunMap.get(this.searchParamList.toString()).reduce((t,e)=>t+e,0)/this.performanceRunMap.get(this.searchParamList.toString()).length;if(this.performanceTotalMap.set(this.searchParamList.toString(),e),this.iterationsCurrent=0,this.searchParamList=this.searchParamStack.pop(),console.log("SimScore:  avgLen=".concat(e," currentParams=").concat(this.searchParamList)),void 0===this.searchParamList){let s=Array.from(this.performanceTotalMap.entries()).slice(this.performanceTotalMap.size-2*this.searchParamListDefault.length);for(let a=0;a<s.length;a+=2)this.searchParamResults.set("Minus".concat(Math.floor(a/2)),s[a+1][1]),this.searchParamResults.set("Plus".concat(Math.floor(a/2)),s[a][1]);this.performanceTotalMap.get(this.searchParamListDefault.toString())>this.performanceTotalMap.get(this.searchParamListBest.toString())&&(this.searchParamListBest=this.searchParamListDefault.flat()),this.searchParamListDefault=this.searchParamListBest.flat(),this.calculateGradient(),this.updateGradientBaseValue(),this.createGradient(),this.searchParamStack.push(this.searchParamList),console.log("MoveDefault bestParam:".concat(this.searchParamListBest," =avg= ").concat(this.performanceTotalMap.get(this.searchParamListBest.toString())," defaultParam").concat(this.searchParamListDefault))}}this.clearAll();return}try{this.choose(t[0],t[1])}catch(r){console.log("random error when close to tail?"),console.log(t),console.log(r),this.clearAll()}this.renderBoard(this.RENDER)}componentDidMount(){}getId(t){let e=Math.floor(t/this.col),s=t%this.col;return[e,s]}makeId(t){return this.col*t[0]+t[1]}ControlButtons(){return(0,a.tZ)("div",{children:(0,a.BX)(i.Z,{color:"error",variant:"contained",children:[(0,a.tZ)(h.Z,{onClick:t=>{setInterval(this.update,this.updateTime)},children:"Start"}),(0,a.tZ)(h.Z,{onClick:()=>{this.test(),Array(1e3).fill(0).map((t,e)=>{clearInterval(e)})},children:"Stop"}),(0,a.tZ)(h.Z,{onClick:()=>{this.clearAll(),Array(1e3).fill(0).map((t,e)=>{clearInterval(e)})},children:"Clear"}),(0,a.tZ)(h.Z,{onClick:()=>{this.test()},children:"Test"})]})})}Sidebar(){return(0,a.BX)(a.HY,{children:[(0,a.tZ)(o.Z,{color:"primary",align:"center",variant:"h3",children:"hello snake"}),(0,a.tZ)("h1",{color:"primary",children:"he"}),this.ControlButtons()]})}Board(){let t=this.boardMap.map(t=>(0,a.tZ)("tr",{children:t.map(t=>{let e=this.getId(parseInt(t[2])).toString();return(0,a.tZ)("td",{id:e,className:t[0]+" cellBase",style:{backgroundColor:t[1]},children:(0,a.tZ)("div",{className:this.path.has(e)?"path":""})})})}));return(0,a.tZ)(a.HY,{children:(0,a.tZ)("table",{children:(0,a.tZ)("tbody",{children:t.map((t,e)=>t)})})})}render(){return(0,a.BX)("div",{children:[(0,a.tZ)(n.Z,{fullWidth:!0,color:"warning",helperText:"nothing here"}),this.Sidebar(),(0,a.tZ)("div",{id:"container",className:"container",children:this.Board()})]})}constructor(t){super(t),this.RENDER=!0,this.LEARN=!1,this.graph=new l.kJ,this.updateTime=50,this.cycles=0,this.row=10,this.col=10,this.curLen=1,this.head=[0,0],this.rear=[0,0],this.board=[],this.tracker=0,this.maxIterations=5e6,this.boardMap=[],this.apple=[3,3],this.snake=[[0,0]],this.swapping=!0,this.runKeys=[],this.lastScore=0,this.curScore=0,this.highScoreLen=0,this.highScoreCycles=0,this.epsilon=2e-6,this.learningRate=.1,this.searchParamList=[2,2,1,0],this.searchParamListDefault=[2,2,1,0],this.searchParamListBest=[2,2,1,0],this.searchParamStack=[],this.searchParamResults=new Map,this.gradient=[],this.performanceRunMap=new Map,this.performanceTotalMap=new Map,this.iterationsPerSim=20,this.iterationsCurrent=0,this.snakeq=new l.ci,this.neighbors=[],this.adjacency=[],this.init=!0,this.path=new Map,this.pathOne=new Map,this.state={frame:0},this.board=Array(this.row).fill(Array(this.col).fill(0)),this.board=this.board.map(t=>t.map(t=>"ground")),this.gradient=Array(this.searchParamList.length).fill(0),this.snakeq.enqueue(this.head),this.renderBoard(!0),this.createGradient(),this.searchParamStack.push(this.searchParamList),this.createAdjacency(),this.renderBoard=this.renderBoard.bind(this),this.update=this.update.bind(this),console.log("end init")}}e.default=y}},function(t){t.O(0,[668,999,774,888,179],function(){return t(t.s=4570)}),_N_E=t.O()}]);